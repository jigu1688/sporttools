import { createSlice, createAsyncThunk } from '@reduxjs/toolkit'
import apiClient from '../utils/apiClient'

// Async thunk: fetch dashboard overview
export const fetchDashboardData = createAsyncThunk(
  'sportsMeet/fetchDashboardData',
  async (_, { rejectWithValue }) => {
    try {
      const response = await apiClient.get('/sports-meets/dashboard')
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Failed to fetch dashboard data')
    }
  }
)

// Async thunk: fetch sports meet list
export const fetchSportsMeets = createAsyncThunk(
  'sportsMeet/fetchSportsMeets',
  async (_, { rejectWithValue }) => {
    try {
      const response = await apiClient.get('/sports-meets')
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Failed to fetch sports meets')
    }
  }
)

// Async thunk: fetch registration stats
export const fetchRegistrationStatistics = createAsyncThunk(
  'sportsMeet/fetchRegistrationStatistics',
  async (sportsMeetId, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}/registration-statistics`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Failed to fetch registration statistics')
    }
  }
)

// Async thunk: fetch a single sports meet
export const fetchSportsMeetById = createAsyncThunk(
  'sportsMeet/fetchSportsMeetById',
  async (sportsMeetId, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Failed to fetch sports meet detail')
    }
  }
)

// Async thunk: create a sports meet
export const createSportsMeet = createAsyncThunk(
  'sportsMeet/createSportsMeet',
  async (sportsMeetData, { rejectWithValue }) => {
    try {
      const response = await apiClient.post('/sports-meets', sportsMeetData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Failed to create sports meet')
    }
  }
)

// Async thunk: update a sports meet
export const updateSportsMeetById = createAsyncThunk(
  'sportsMeet/updateSportsMeetById',
  async ({ sportsMeetId, sportsMeetData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.put(`/sports-meets/${sportsMeetId}`, sportsMeetData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Failed to update sports meet')
    }
  }
)

// Async thunk: delete a sports meet
export const deleteSportsMeetById = createAsyncThunk(
  'sportsMeet/deleteSportsMeetById',
  async (sportsMeetId, { rejectWithValue }) => {
    try {
      await apiClient.delete(`/sports-meets/${sportsMeetId}`)
      return sportsMeetId
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Failed to delete sports meet')
    }
  }
)

// Async thunk
export const fetchEvents = createAsyncThunk(
  'sportsMeet/fetchEvents',
  async (sportsMeetId, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}/events`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const fetchEventById = createAsyncThunk(
  'sportsMeet/fetchEventById',
  async ({ sportsMeetId, eventId }, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}/events/${eventId}`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const createEvent = createAsyncThunk(
  'sportsMeet/createEvent',
  async ({ sportsMeetId, eventData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.post(`/sports-meets/${sportsMeetId}/events`, eventData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const updateEventById = createAsyncThunk(
  'sportsMeet/updateEventById',
  async ({ sportsMeetId, eventId, eventData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.put(`/sports-meets/${sportsMeetId}/events/${eventId}`, eventData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const deleteEventById = createAsyncThunk(
  'sportsMeet/deleteEventById',
  async ({ sportsMeetId, eventId }, { rejectWithValue }) => {
    try {
      await apiClient.delete(`/sports-meets/${sportsMeetId}/events/${eventId}`)
      return { sportsMeetId, eventId }
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Registration management
// Async thunk
export const fetchRegistrations = createAsyncThunk(
  'sportsMeet/fetchRegistrations',
  async ({ sportsMeetId, filters = {} }, { rejectWithValue }) => {
    try {
      const params = new URLSearchParams(filters).toString()
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}/registrations${params ? `?${params}` : ''}`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const createRegistration = createAsyncThunk(
  'sportsMeet/createRegistration',
  async ({ sportsMeetId, registrationData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.post(`/sports-meets/${sportsMeetId}/registrations`, registrationData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const batchCreateRegistrations = createAsyncThunk(
  'sportsMeet/batchCreateRegistrations',
  async ({ sportsMeetId, registrationsData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.post(`/sports-meets/${sportsMeetId}/registrations/batch`, registrationsData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const deleteRegistrationById = createAsyncThunk(
  'sportsMeet/deleteRegistrationById',
  async ({ sportsMeetId, registrationId }, { rejectWithValue }) => {
    try {
      await apiClient.delete(`/sports-meets/${sportsMeetId}/registrations/${registrationId}`)
      return { sportsMeetId, registrationId }
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Registration management
// 寮傛thunk锛氳幏鍙栧緟瀹℃牳鎶ュ悕
export const fetchPendingRegistrations = createAsyncThunk(
  'sportsMeet/fetchPendingRegistrations',
  async (sportsMeetId, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}/registrations/pending`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Failed to fetch pending registrations')
    }
  }
)

// 寮傛thunk锛氬鏍搁€氳繃鎶ュ悕
export const approveRegistration = createAsyncThunk(
  'sportsMeet/approveRegistration',
  async ({ sportsMeetId, registrationId }, { rejectWithValue }) => {
    try {
      const response = await apiClient.put(`/sports-meets/${sportsMeetId}/registrations/${registrationId}/approve`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const rejectRegistration = createAsyncThunk(
  'sportsMeet/rejectRegistration',
  async ({ sportsMeetId, registrationId, reason }, { rejectWithValue }) => {
    try {
      const response = await apiClient.put(`/sports-meets/${sportsMeetId}/registrations/${registrationId}/reject`, { reason })
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Venue management
// Async thunk
export const fetchVenues = createAsyncThunk(
  'sportsMeet/fetchVenues',
  async (_, { rejectWithValue }) => {
    try {
      const response = await apiClient.get('/sports-meets/venues')
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const fetchVenueById = createAsyncThunk(
  'sportsMeet/fetchVenueById',
  async (venueId, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/venues/${venueId}`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const createVenue = createAsyncThunk(
  'sportsMeet/createVenue',
  async (venueData, { rejectWithValue }) => {
    try {
      const response = await apiClient.post('/sports-meets/venues', venueData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const updateVenueById = createAsyncThunk(
  'sportsMeet/updateVenueById',
  async ({ venueId, venueData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.put(`/sports-meets/venues/${venueId}`, venueData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const deleteVenueById = createAsyncThunk(
  'sportsMeet/deleteVenueById',
  async (venueId, { rejectWithValue }) => {
    try {
      await apiClient.delete(`/sports-meets/venues/${venueId}`)
      return venueId
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Referee management
// Async thunk
export const fetchReferees = createAsyncThunk(
  'sportsMeet/fetchReferees',
  async (_, { rejectWithValue }) => {
    try {
      const response = await apiClient.get('/sports-meets/referees')
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const fetchRefereeById = createAsyncThunk(
  'sportsMeet/fetchRefereeById',
  async (refereeId, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/referees/${refereeId}`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const createReferee = createAsyncThunk(
  'sportsMeet/createReferee',
  async (refereeData, { rejectWithValue }) => {
    try {
      const response = await apiClient.post('/sports-meets/referees', refereeData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const updateRefereeById = createAsyncThunk(
  'sportsMeet/updateRefereeById',
  async ({ refereeId, refereeData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.put(`/sports-meets/referees/${refereeId}`, refereeData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const deleteRefereeById = createAsyncThunk(
  'sportsMeet/deleteRefereeById',
  async (refereeId, { rejectWithValue }) => {
    try {
      await apiClient.delete(`/sports-meets/referees/${refereeId}`)
      return refereeId
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Schedule management
// Async thunk
export const fetchSchedules = createAsyncThunk(
  'sportsMeet/fetchSchedules',
  async ({ sportsMeetId }, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}/schedules`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const fetchScheduleById = createAsyncThunk(
  'sportsMeet/fetchScheduleById',
  async ({ sportsMeetId, scheduleId }, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}/schedules/${scheduleId}`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const createSchedule = createAsyncThunk(
  'sportsMeet/createSchedule',
  async ({ sportsMeetId, scheduleData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.post(`/sports-meets/${sportsMeetId}/schedules`, scheduleData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const updateScheduleById = createAsyncThunk(
  'sportsMeet/updateScheduleById',
  async ({ sportsMeetId, scheduleId, scheduleData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.put(`/sports-meets/${sportsMeetId}/schedules/${scheduleId}`, scheduleData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const deleteScheduleById = createAsyncThunk(
  'sportsMeet/deleteScheduleById',
  async ({ sportsMeetId, scheduleId }, { rejectWithValue }) => {
    try {
      await apiClient.delete(`/sports-meets/${sportsMeetId}/schedules/${scheduleId}`)
      return scheduleId
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Score management
// Async thunk
export const fetchResults = createAsyncThunk(
  'sportsMeet/fetchResults',
  async ({ sportsMeetId, eventId }, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}/results${eventId ? `?event_id=${eventId}` : ''}`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const fetchResultById = createAsyncThunk(
  'sportsMeet/fetchResultById',
  async ({ sportsMeetId, resultId }, { rejectWithValue }) => {
    try {
      const response = await apiClient.get(`/sports-meets/${sportsMeetId}/results/${resultId}`)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const createResult = createAsyncThunk(
  'sportsMeet/createResult',
  async ({ sportsMeetId, resultData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.post(`/sports-meets/${sportsMeetId}/results`, resultData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const updateResultById = createAsyncThunk(
  'sportsMeet/updateResultById',
  async ({ sportsMeetId, resultId, resultData }, { rejectWithValue }) => {
    try {
      const response = await apiClient.put(`/sports-meets/${sportsMeetId}/results/${resultId}`, resultData)
      return response.data
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// Async thunk
export const deleteResultById = createAsyncThunk(
  'sportsMeet/deleteResultById',
  async ({ sportsMeetId, resultId }, { rejectWithValue }) => {
    try {
      await apiClient.delete(`/sports-meets/${sportsMeetId}/results/${resultId}`)
      return resultId
    } catch (error) {
      return rejectWithValue(error.response?.data?.detail || 'Operation failed')
    }
  }
)

// 鍒濆鐘舵€?const initialState = {
  // 浠〃鐩樻暟鎹?  dashboardData: {
    totalSportsMeets: 0,
    upcomingSportsMeets: 0,
    totalAthletes: 0,
    totalEvents: 0,
    totalRegistrations: 0
  },
  // 杩愬姩浼氬垪琛?  sportsMeets: [],
  // 褰撳墠閫変腑鐨勮繍鍔ㄤ細
  currentSportsMeet: null,
  // 椤圭洰鍒楄〃
  events: [],
  // 杩愬姩鍛樺垪琛?  athletes: [],
  // Registration management
  registrations: [],
  // Schedule management
  schedules: [],
  // 鍒嗙粍淇℃伅
  groups: [],
  // Score management
  results: [],
  // Referee management
  referees: [],
  // Referee management
  refereeAssignments: [],
  // 缂栧彿瑙勫垯閰嶇疆
  numberingRules: {
    // 榛樿瑙勫垯
    default: {
      format: 'grade+class+gender+sequence', // 缂栧彿鏍煎紡锛氬勾绾?鐝骇+鎬у埆+搴忓彿
      gradeDigits: 1, // 骞寸骇浣嶆暟
      classDigits: 1, // 鐝骇浣嶆暟
      genderDigits: 1, // 鎬у埆浣嶆暟锛?:鐢? 2:濂筹級
      sequenceDigits: 1, // 搴忓彿浣嶆暟
      separator: '' // 鍒嗛殧绗?    }
  },
  // Venue management
  venues: [],
  // 鍔犺浇鐘舵€?  loading: false,
  // 閿欒淇℃伅
  error: null
}

// 鍒涘缓杩愬姩浼歴lice
export const sportsMeetSlice = createSlice({
  name: 'sportsMeet',
  initialState,
  reducers: {
    // 杩愬姩浼氱浉鍏?    setSportsMeets: (state, action) => {
      state.sportsMeets = action.payload
    },
    addSportsMeet: (state, action) => {
      state.sportsMeets.push(action.payload)
    },
    updateSportsMeet: (state, action) => {
      const index = state.sportsMeets.findIndex(meet => meet.id === action.payload.id)
      if (index !== -1) {
        state.sportsMeets[index] = action.payload
      }
    },
    deleteSportsMeet: (state, action) => {
      state.sportsMeets = state.sportsMeets.filter(meet => meet.id !== action.payload)
    },
    setCurrentSportsMeet: (state, action) => {
      state.currentSportsMeet = action.payload
    },
    
    // 椤圭洰鐩稿叧
    setEvents: (state, action) => {
      state.events = action.payload
    },
    addEvent: (state, action) => {
      state.events.push(action.payload)
    },
    updateEvent: (state, action) => {
      const index = state.events.findIndex(event => event.id === action.payload.id)
      if (index !== -1) {
        state.events[index] = action.payload
      }
    },
    deleteEvent: (state, action) => {
      state.events = state.events.filter(event => event.id !== action.payload)
    },
    
    // 杩愬姩鍛樼浉鍏?    setAthletes: (state, action) => {
      state.athletes = action.payload
    },
    addAthlete: (state, action) => {
      state.athletes.push(action.payload)
    },
    updateAthlete: (state, action) => {
      const index = state.athletes.findIndex(athlete => athlete.id === action.payload.id)
      if (index !== -1) {
        state.athletes[index] = action.payload
      }
    },
    deleteAthlete: (state, action) => {
      state.athletes = state.athletes.filter(athlete => athlete.id !== action.payload)
    },
    
    // Registration management
    setRegistrations: (state, action) => {
      state.registrations = action.payload
    },
    addRegistration: (state, action) => {
      state.registrations.push(action.payload)
    },
    batchAddRegistrations: (state, action) => {
      state.registrations.push(...action.payload)
    },
    updateRegistration: (state, action) => {
      const index = state.registrations.findIndex(registration => registration.id === action.payload.id)
      if (index !== -1) {
        state.registrations[index] = action.payload
      }
    },
    deleteRegistration: (state, action) => {
      state.registrations = state.registrations.filter(registration => registration.id !== action.payload)
    },
    batchRemoveRegistrations: (state, action) => {
      state.registrations = state.registrations.filter(registration => !action.payload.includes(registration.id))
    },
    
    // Schedule management
    setSchedules: (state, action) => {
      state.schedules = action.payload
    },
    addSchedule: (state, action) => {
      state.schedules.push(action.payload)
    },
    updateSchedule: (state, action) => {
      const index = state.schedules.findIndex(schedule => schedule.id === action.payload.id)
      if (index !== -1) {
        state.schedules[index] = action.payload
      }
    },
    deleteSchedule: (state, action) => {
      state.schedules = state.schedules.filter(schedule => schedule.id !== action.payload)
    },
    
    // 鍒嗙粍鐩稿叧
    setGroups: (state, action) => {
      state.groups = action.payload
    },
    addGroup: (state, action) => {
      state.groups.push(action.payload)
    },
    updateGroup: (state, action) => {
      const index = state.groups.findIndex(group => group.id === action.payload.id)
      if (index !== -1) {
        state.groups[index] = action.payload
      }
    },
    deleteGroup: (state, action) => {
      state.groups = state.groups.filter(group => group.id !== action.payload)
    },
    
    // Score management
    setResults: (state, action) => {
      state.results = action.payload
    },
    addResult: (state, action) => {
      state.results.push(action.payload)
    },
    updateResult: (state, action) => {
      const index = state.results.findIndex(result => result.id === action.payload.id)
      if (index !== -1) {
        state.results[index] = action.payload
      }
    },
    deleteResult: (state, action) => {
      state.results = state.results.filter(result => result.id !== action.payload)
    },
    
    // Referee management
    setReferees: (state, action) => {
      state.referees = action.payload
    },
    addReferee: (state, action) => {
      state.referees.push(action.payload)
    },
    updateReferee: (state, action) => {
      const index = state.referees.findIndex(referee => referee.id === action.payload.id)
      if (index !== -1) {
        state.referees[index] = action.payload
      }
    },
    deleteReferee: (state, action) => {
      state.referees = state.referees.filter(referee => referee.id !== action.payload)
    },
    
    // Referee management
    setRefereeAssignments: (state, action) => {
      state.refereeAssignments = action.payload
    },
    addRefereeAssignment: (state, action) => {
      state.refereeAssignments.push(action.payload)
    },
    updateRefereeAssignment: (state, action) => {
      const index = state.refereeAssignments.findIndex(assignment => assignment.id === action.payload.id)
      if (index !== -1) {
        state.refereeAssignments[index] = action.payload
      }
    },
    deleteRefereeAssignment: (state, action) => {
      state.refereeAssignments = state.refereeAssignments.filter(assignment => assignment.id !== action.payload)
    },
    
    // Venue management
    setVenues: (state, action) => {
      state.venues = action.payload
    },
    addVenue: (state, action) => {
      state.venues.push(action.payload)
    },
    updateVenue: (state, action) => {
      const index = state.venues.findIndex(venue => venue.id === action.payload.id)
      if (index !== -1) {
        state.venues[index] = action.payload
      }
    },
    deleteVenue: (state, action) => {
      state.venues = state.venues.filter(venue => venue.id !== action.payload)
    },
    
    // 缂栧彿瑙勫垯閰嶇疆
    setNumberingRules: (state, action) => {
      state.numberingRules = action.payload
    },
    updateNumberingRule: (state, action) => {
      const { ruleId, ...ruleConfig } = action.payload
      state.numberingRules[ruleId] = ruleConfig
    },
    addNumberingRule: (state, action) => {
      const { ruleId, ...ruleConfig } = action.payload
      state.numberingRules[ruleId] = ruleConfig
    },
    deleteNumberingRule: (state, action) => {
      delete state.numberingRules[action.payload]
    },
    
    // 鍔犺浇鐘舵€佺鐞?    setLoading: (state, action) => {
      state.loading = action.payload
    },
    setError: (state, action) => {
      state.error = action.payload
    },
    clearError: (state) => {
      state.error = null
    },
    // 浠〃鐩樻暟鎹鐞?    setDashboardData: (state, action) => {
      state.dashboardData = action.payload
    }
  },
  extraReducers: (builder) => {
    // 澶勭悊鑾峰彇浠〃鐩樻暟鎹?    builder
      .addCase(fetchDashboardData.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchDashboardData.fulfilled, (state, action) => {
        state.loading = false
        state.dashboardData = action.payload
      })
      .addCase(fetchDashboardData.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鑾峰彇杩愬姩浼氬垪琛?    builder
      .addCase(fetchSportsMeets.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchSportsMeets.fulfilled, (state, action) => {
        state.loading = false
        state.sportsMeets = action.payload
      })
      .addCase(fetchSportsMeets.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鑾峰彇鎶ュ悕缁熻鏁版嵁
    builder
      .addCase(fetchRegistrationStatistics.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchRegistrationStatistics.fulfilled, (state, action) => {
        state.loading = false
        // 鍙互鏍规嵁闇€瑕佸皢缁熻鏁版嵁瀛樺偍鍦╯tate涓?      })
      .addCase(fetchRegistrationStatistics.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鑾峰彇鍗曚釜杩愬姩浼氳鎯?    builder
      .addCase(fetchSportsMeetById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchSportsMeetById.fulfilled, (state, action) => {
        state.loading = false
        state.currentSportsMeet = action.payload
      })
      .addCase(fetchSportsMeetById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鍒涘缓杩愬姩浼?    builder
      .addCase(createSportsMeet.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(createSportsMeet.fulfilled, (state, action) => {
        state.loading = false
        state.sportsMeets.push(action.payload)
      })
      .addCase(createSportsMeet.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鏇存柊杩愬姩浼?    builder
      .addCase(updateSportsMeetById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(updateSportsMeetById.fulfilled, (state, action) => {
        state.loading = false
        const index = state.sportsMeets.findIndex(meet => meet.id === action.payload.id)
        if (index !== -1) {
          state.sportsMeets[index] = action.payload
        }
        if (state.currentSportsMeet && state.currentSportsMeet.id === action.payload.id) {
          state.currentSportsMeet = action.payload
        }
      })
      .addCase(updateSportsMeetById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鍒犻櫎杩愬姩浼?    builder
      .addCase(deleteSportsMeetById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(deleteSportsMeetById.fulfilled, (state, action) => {
        state.loading = false
        state.sportsMeets = state.sportsMeets.filter(meet => meet.id !== action.payload)
        if (state.currentSportsMeet && state.currentSportsMeet.id === action.payload) {
          state.currentSportsMeet = null
        }
      })
      .addCase(deleteSportsMeetById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鑾峰彇椤圭洰鍒楄〃
    builder
      .addCase(fetchEvents.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchEvents.fulfilled, (state, action) => {
        state.loading = false
        state.events = action.payload
      })
      .addCase(fetchEvents.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鑾峰彇鍗曚釜椤圭洰璇︽儏
    builder
      .addCase(fetchEventById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchEventById.fulfilled, (state, action) => {
        state.loading = false
        // 鍙互鏍规嵁闇€瑕佸皢鍗曚釜椤圭洰璇︽儏瀛樺偍鍦╯tate涓?      })
      .addCase(fetchEventById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鍒涘缓椤圭洰
    builder
      .addCase(createEvent.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(createEvent.fulfilled, (state, action) => {
        state.loading = false
        state.events.push(action.payload)
      })
      .addCase(createEvent.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鏇存柊椤圭洰
    builder
      .addCase(updateEventById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(updateEventById.fulfilled, (state, action) => {
        state.loading = false
        const index = state.events.findIndex(event => event.id === action.payload.id)
        if (index !== -1) {
          state.events[index] = action.payload
        }
      })
      .addCase(updateEventById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鍒犻櫎椤圭洰
    builder
      .addCase(deleteEventById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(deleteEventById.fulfilled, (state, action) => {
        state.loading = false
        state.events = state.events.filter(event => event.id !== action.payload.eventId)
      })
      .addCase(deleteEventById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 澶勭悊鎶ュ悕绠＄悊鐩稿叧寮傛thunk
    // 鑾峰彇鎶ュ悕鍒楄〃
    builder
      .addCase(fetchRegistrations.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchRegistrations.fulfilled, (state, action) => {
        state.loading = false
        state.registrations = action.payload
      })
      .addCase(fetchRegistrations.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 鍒涘缓鎶ュ悕
    builder
      .addCase(createRegistration.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(createRegistration.fulfilled, (state, action) => {
        state.loading = false
        state.registrations.push(action.payload)
      })
      .addCase(createRegistration.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 鎵归噺鍒涘缓鎶ュ悕
    builder
      .addCase(batchCreateRegistrations.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(batchCreateRegistrations.fulfilled, (state, action) => {
        state.loading = false
        state.registrations.push(...action.payload)
      })
      .addCase(batchCreateRegistrations.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 鍒犻櫎鎶ュ悕
    builder
      .addCase(deleteRegistrationById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(deleteRegistrationById.fulfilled, (state, action) => {
        state.loading = false
        state.registrations = state.registrations.filter(reg => reg.id !== action.payload.registrationId)
      })
      .addCase(deleteRegistrationById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 鑾峰彇寰呭鏍告姤鍚?    builder
      .addCase(fetchPendingRegistrations.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchPendingRegistrations.fulfilled, (state, action) => {
        state.loading = false
        // 鍙互灏嗗緟瀹℃牳鎶ュ悕鍗曠嫭瀛樺偍锛屾垨鑰呬娇鐢╢ilters鍙傛暟鑾峰彇
        // 杩欓噷鏆傛椂灏嗗叾瀛樺偍鍒皉egistrations涓紝瀹為檯浣跨敤鏃跺彲浠ユ牴鎹渶瑕佽皟鏁?        state.registrations = action.payload
      })
      .addCase(fetchPendingRegistrations.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 瀹℃牳閫氳繃鎶ュ悕
    builder
      .addCase(approveRegistration.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(approveRegistration.fulfilled, (state, action) => {
        state.loading = false
        const index = state.registrations.findIndex(reg => reg.id === action.payload.id)
        if (index !== -1) {
          state.registrations[index] = action.payload
        }
      })
      .addCase(approveRegistration.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
      
    // 瀹℃牳鎷掔粷鎶ュ悕
    builder
      .addCase(rejectRegistration.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(rejectRegistration.fulfilled, (state, action) => {
        state.loading = false
        const index = state.registrations.findIndex(reg => reg.id === action.payload.id)
        if (index !== -1) {
          state.registrations[index] = action.payload
        }
      })
      .addCase(rejectRegistration.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // Venue management
    // 鑾峰彇鍦洪鍒楄〃
    builder
      .addCase(fetchVenues.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchVenues.fulfilled, (state, action) => {
        state.loading = false
        state.venues = action.payload
      })
      .addCase(fetchVenues.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鍒涘缓鍦洪
    builder
      .addCase(createVenue.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(createVenue.fulfilled, (state, action) => {
        state.loading = false
        state.venues.push(action.payload)
      })
      .addCase(createVenue.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鏇存柊鍦洪
    builder
      .addCase(updateVenueById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(updateVenueById.fulfilled, (state, action) => {
        state.loading = false
        const index = state.venues.findIndex(venue => venue.id === action.payload.id)
        if (index !== -1) {
          state.venues[index] = action.payload
        }
      })
      .addCase(updateVenueById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鍒犻櫎鍦洪
    builder
      .addCase(deleteVenueById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(deleteVenueById.fulfilled, (state, action) => {
        state.loading = false
        state.venues = state.venues.filter(venue => venue.id !== action.payload)
      })
      .addCase(deleteVenueById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // Referee management
    // 鑾峰彇瑁佸垽鍒楄〃
    builder
      .addCase(fetchReferees.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchReferees.fulfilled, (state, action) => {
        state.loading = false
        state.referees = action.payload
      })
      .addCase(fetchReferees.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鍒涘缓瑁佸垽
    builder
      .addCase(createReferee.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(createReferee.fulfilled, (state, action) => {
        state.loading = false
        state.referees.push(action.payload)
      })
      .addCase(createReferee.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鏇存柊瑁佸垽
    builder
      .addCase(updateRefereeById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(updateRefereeById.fulfilled, (state, action) => {
        state.loading = false
        const index = state.referees.findIndex(referee => referee.id === action.payload.id)
        if (index !== -1) {
          state.referees[index] = action.payload
        }
      })
      .addCase(updateRefereeById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鍒犻櫎瑁佸垽
    builder
      .addCase(deleteRefereeById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(deleteRefereeById.fulfilled, (state, action) => {
        state.loading = false
        state.referees = state.referees.filter(referee => referee.id !== action.payload)
      })
      .addCase(deleteRefereeById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // Schedule management
    // 鑾峰彇璧涚▼鍒楄〃
    builder
      .addCase(fetchSchedules.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchSchedules.fulfilled, (state, action) => {
        state.loading = false
        state.schedules = action.payload
      })
      .addCase(fetchSchedules.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鍒涘缓璧涚▼
    builder
      .addCase(createSchedule.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(createSchedule.fulfilled, (state, action) => {
        state.loading = false
        state.schedules.push(action.payload)
      })
      .addCase(createSchedule.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鏇存柊璧涚▼
    builder
      .addCase(updateScheduleById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(updateScheduleById.fulfilled, (state, action) => {
        state.loading = false
        const index = state.schedules.findIndex(schedule => schedule.id === action.payload.id)
        if (index !== -1) {
          state.schedules[index] = action.payload
        }
      })
      .addCase(updateScheduleById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鍒犻櫎璧涚▼
    builder
      .addCase(deleteScheduleById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(deleteScheduleById.fulfilled, (state, action) => {
        state.loading = false
        state.schedules = state.schedules.filter(schedule => schedule.id !== action.payload)
      })
      .addCase(deleteScheduleById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // Score management
    // 鑾峰彇鎴愮哗鍒楄〃
    builder
      .addCase(fetchResults.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(fetchResults.fulfilled, (state, action) => {
        state.loading = false
        state.results = action.payload
      })
      .addCase(fetchResults.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鍒涘缓鎴愮哗
    builder
      .addCase(createResult.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(createResult.fulfilled, (state, action) => {
        state.loading = false
        state.results.push(action.payload)
      })
      .addCase(createResult.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鏇存柊鎴愮哗
    builder
      .addCase(updateResultById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(updateResultById.fulfilled, (state, action) => {
        state.loading = false
        const index = state.results.findIndex(result => result.id === action.payload.id)
        if (index !== -1) {
          state.results[index] = action.payload
        }
      })
      .addCase(updateResultById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
    
    // 鍒犻櫎鎴愮哗
    builder
      .addCase(deleteResultById.pending, (state) => {
        state.loading = true
        state.error = null
      })
      .addCase(deleteResultById.fulfilled, (state, action) => {
        state.loading = false
        state.results = state.results.filter(result => result.id !== action.payload)
      })
      .addCase(deleteResultById.rejected, (state, action) => {
        state.loading = false
        state.error = action.payload
      })
  }
})

// 瀵煎嚭action creators
export const {
  // 杩愬姩浼氱浉鍏?  setSportsMeets,
  addSportsMeet,
  updateSportsMeet,
  deleteSportsMeet,
  setCurrentSportsMeet,
  
  // 椤圭洰鐩稿叧
  setEvents,
  addEvent,
  updateEvent,
  deleteEvent,
  
  // 杩愬姩鍛樼浉鍏?  setAthletes,
  addAthlete,
  updateAthlete,
  deleteAthlete,
  
  // Registration management
  setRegistrations,
  addRegistration,
  batchAddRegistrations,
  updateRegistration,
  deleteRegistration,
  batchRemoveRegistrations,
  
  // Schedule management
  setSchedules,
  addSchedule,
  updateSchedule,
  deleteSchedule,
  
  // 鍒嗙粍鐩稿叧
  setGroups,
  addGroup,
  updateGroup,
  deleteGroup,
  
  // Score management
  setResults,
  addResult,
  updateResult,
  deleteResult,
  
  // Referee management
  setReferees,
  addReferee,
  updateReferee,
  deleteReferee,
  
  // Referee management
  setRefereeAssignments,
  addRefereeAssignment,
  updateRefereeAssignment,
  deleteRefereeAssignment,
  
  // Venue management
  setVenues,
  addVenue,
  updateVenue,
  deleteVenue,
  
  // 缂栧彿瑙勫垯閰嶇疆
  setNumberingRules,
  updateNumberingRule,
  addNumberingRule,
  deleteNumberingRule,
  
  // 鍔犺浇鐘舵€佺鐞?  setLoading,
  setError,
  clearError,
  // 浠〃鐩樻暟鎹鐞?  setDashboardData
} = sportsMeetSlice.actions

// 瀵煎嚭reducer
export default sportsMeetSlice.reducer
