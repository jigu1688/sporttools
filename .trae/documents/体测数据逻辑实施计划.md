# 体测数据逻辑实施计划

## 1. 数据结构调整

### 1.1 体测记录数据结构修改
- 将 `studentNo` 字段重命名为 `educationId`
- 确保 `educationId` 字段在数据库和前端显示中均使用该名称
- 保留与学生管理系统的关联关系

### 1.2 测试项目关联调整
- 在测试项目中添加 `applicableStages` 字段，用于标记适用学段（小学、初中、高中）
- 完善各测试项目的学段适用范围配置

## 2. 学生信息同步机制

### 2.1 建立学生数据关联
- 在体测记录中保留 `educationId` 作为唯一标识符
- 移除冗余的学生基本信息字段（姓名、性别、年级、班级等）
- 实现通过 `educationId` 从学生管理系统动态获取学生信息

### 2.2 同步逻辑实现
- 页面加载时，根据体测记录中的 `educationId` 批量获取学生信息
- 实现实时同步机制，确保学生信息变更时体测数据中的关联信息也能更新
- 处理学生信息不存在的异常情况

## 3. 成绩项目自动匹配

### 3.1 学段信息获取
- 从学校信息中获取学段信息（小学、初中、高中）
- 确保学段信息在系统中正确配置

### 3.2 成绩项目匹配逻辑
- 根据学段信息动态筛选适用的测试项目
- 小学：身高、体重、BMI、肺活量、50米跑、坐位体前屈、1分钟跳绳、1分钟仰卧起坐、50米×8往返跑
- 初中：身高、体重、BMI、肺活量、50米跑、坐位体前屈、立定跳远、引体向上（男）/1分钟仰卧起坐（女）、1000米跑（男）/800米跑（女）
- 高中/大学：与初中相同

### 3.3 前端动态渲染
- 根据匹配结果动态渲染成绩录入和展示表单
- 确保不同学段的学生显示正确的测试项目

## 4. 学生成绩导入逻辑优化

### 4.1 导入模板调整
- 更新导入模板，使用 `教育ID` 作为唯一标识符
- 保留 `全国学籍号` 作为备选匹配字段
- 移除模板中除成绩列外的其他学生信息字段

### 4.2 索引字段选择功能
- 在导入界面添加索引字段选择下拉框
- 提供选项：教育ID、全国学籍号
- 确保选择的索引字段具有唯一性验证

### 4.3 成绩填充逻辑
- 根据选择的索引字段，在学生管理系统中查找匹配的学生
- 将匹配到的学生的教育ID关联到体测记录
- 填充对应的成绩数据到匹配到的学生记录中
- 处理匹配失败的情况，提供清晰的错误提示

## 5. 实施步骤

1. **数据结构调整**：修改体测记录数据结构，将学号改为教育ID
2. **学生信息同步**：实现与学生管理系统的信息同步机制
3. **学段项目匹配**：开发根据学段自动匹配测试项目的逻辑
4. **导入功能优化**：添加索引字段选择和成绩填充逻辑
5. **测试验证**：对各功能进行全面测试，确保数据一致性和功能正确性
6. **文档更新**：更新相关文档，包括使用说明和API文档

## 6. 预期效果

- 体测数据与学生管理系统保持数据一致性
- 不同学段的学生显示正确的测试项目
- 导入流程更加灵活，支持多种索引字段匹配
- 减少数据冗余，提高系统性能
- 提高数据准确性，避免重复录入

## 7. 风险评估

- **学生信息同步延迟**：需确保同步机制的实时性
- **索引字段冲突**：需确保选择的索引字段具有唯一性
- **学段项目匹配错误**：需仔细验证各学段的测试项目配置
- **导入数据量过大**：需考虑大数据量导入的性能优化

## 8. 依赖关系

- 学生管理系统提供稳定的API接口
- 学校信息中学段字段配置正确
- 测试项目的学段适用范围配置完整