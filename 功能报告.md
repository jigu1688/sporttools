# 体育教学辅助系统 - 功能报告

**生成日期**: 2026年1月10日

---

## 一、系统概述

本项目是一套完整的**体育教学辅助管理系统**，采用前后端分离架构，主要服务于学校体育教学管理场景。系统包含三大核心模块：
1. **基础信息管理** - 学校、学年、班级、学生、用户管理
2. **学生体测系统** - 体测数据录入、统计分析、成绩评定
3. **运动会编排系统** - 运动会管理、项目报名、赛程编排、成绩记录

---

## 二、技术架构

### 后端 (sport-api)
| 组件 | 技术栈 |
|------|--------|
| 框架 | FastAPI |
| 数据库 | SQLite (SQLAlchemy ORM) |
| 认证 | JWT Token |
| 缓存 | Redis (可选) |
| 速率限制 | SlowAPI |

### 前端 (sport-web)
| 组件 | 技术栈 |
|------|--------|
| 框架 | React + Vite |
| 状态管理 | Redux |
| 路由 | React Router |
| UI组件 | 自定义组件 |

---

## 三、数据模型关联关系

### 3.1 核心实体关系图

```
┌─────────────┐      1:N      ┌─────────────┐      1:N      ┌─────────────┐
│   School    │──────────────▶│ SchoolYear  │──────────────▶│    Class    │
│   学校      │               │    学年     │               │    班级     │
└─────────────┘               └─────────────┘               └──────┬──────┘
       │                                                          │
       │ 1:N                                               N:M    │
       ▼                                          (StudentClassRelation)
┌─────────────┐                                                   │
│    User     │◀──────────────────────────────────────────────────┤
│    用户     │                                                   │
└─────────────┘                                                   ▼
       │                                                 ┌─────────────┐
       │ 1:1                                             │   Student   │
       ▼                                                 │    学生     │
┌─────────────┐                                          └──────┬──────┘
│   Token     │                                                 │
│   令牌      │                                                 │ 1:N
└─────────────┘                                                 ▼
                                                        ┌─────────────┐
                                                        │PhysicalTest │
                                                        │  体测数据   │
                                                        └─────────────┘
```

### 3.2 运动会模块关系图

```
┌─────────────────┐
│   SportsMeet    │──────────────────────────────────┐
│     运动会      │                                  │
└────────┬────────┘                                  │
         │ 1:N                                       │ 1:N
         ▼                                           ▼
┌─────────────────┐      N:1      ┌─────────────────────┐
│     Event       │◀──────────────│   Registration      │
│     项目        │               │       报名          │
└────────┬────────┘               └──────────┬──────────┘
         │                                   │
         │ N:1                               │ N:1
         ▼                                   ▼
┌─────────────────┐               ┌─────────────────────┐
│     Venue       │               │      Student        │
│     场馆        │               │       学生          │
└─────────────────┘               └─────────────────────┘
         │
         │ 1:N
         ▼
┌─────────────────┐
│    Schedule     │
│     赛程        │
└─────────────────┘
```

---

## 四、数据模型详细说明

### 4.1 基础信息模型

#### School (学校)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| school_name | String(200) | 学校名称 |
| school_code | String(50) | 学校代码（唯一） |
| address | Text | 学校地址 |
| contact_info | String(200) | 联系方式 |
| logo_url | String(500) | 学校Logo地址 |
| status | Enum | 状态(active/inactive) |

**关联关系**:
- `1:N` → Class (班级)
- `1:N` → User (用户)
- `1:N` → SchoolYear (学年)
- `1:N` → SportsMeet (运动会)

#### SchoolYear (学年)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| school_id | Integer | 所属学校ID (FK) |
| year_name | String(50) | 学年名称 |
| start_date | Date | 起始日期 |
| end_date | Date | 结束日期 |
| academic_year | String(20) | 学年标识（唯一） |
| status | Enum | 状态(active/completed/inactive) |

**关联关系**:
- `N:1` → School (学校)
- `1:N` → Class (班级)
- `1:N` → SportsMeet (运动会)

#### Class (班级)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| class_name | String(100) | 班级名称 |
| grade | String(20) | 年级 |
| grade_level | Integer | 年级级别(1-12) |
| academic_year | String(20) | 学年 |
| class_teacher_id | Integer | 班主任ID (FK) |
| school_id | Integer | 所属学校ID (FK) |
| school_year_id | Integer | 所属学年ID (FK) |
| max_student_count | Integer | 最大学生数 |
| current_student_count | Integer | 当前学生数 |

**关联关系**:
- `N:1` → School (学校)
- `N:1` → SchoolYear (学年)
- `1:N` → StudentClassRelation (学生班级关联)
- `1:N` → PhysicalTest (体测数据)

### 4.2 用户与学生模型

#### User (用户)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| username | String(50) | 用户名（唯一） |
| email | String(100) | 邮箱（唯一） |
| phone | String(20) | 电话号码 |
| hashed_password | String(255) | 加密密码 |
| real_name | String(100) | 真实姓名 |
| gender | Enum | 性别(male/female) |
| role | Enum | 角色(admin/teacher/student/parent) |
| school_id | Integer | 所属学校ID (FK) |
| status | Enum | 状态 |

**关联关系**:
- `N:1` → School (学校)
- `1:N` → Student (学生档案)
- `1:N` → Token (令牌)
- `1:N` → UserActivityLog (活动日志)
- `1:N` → PasswordHistory (密码历史)
- `1:1` → UserPreference (用户偏好)

#### Student (学生)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| student_no | String(50) | 学籍号（唯一） |
| real_name | String(100) | 姓名 |
| gender | Enum | 性别 |
| birth_date | Date | 出生日期 |
| id_card | String(18) | 身份证号 |
| health_status | Text | 健康状况 |
| sports_level | Enum | 体育水平(excellent/good/average/poor) |
| sports_specialty | String(200) | 运动特长 |
| user_id | Integer | 关联用户ID (FK) |
| enrollment_date | Date | 入学日期 |

**关联关系**:
- `N:1` → User (用户)
- `1:N` → StudentClassRelation (班级关联)
- `1:1` → FamilyInfo (家庭信息)
- `1:N` → PhysicalTest (体测数据)
- `1:N` → Registration (报名信息)

#### StudentClassRelation (学生班级关联)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| student_id | Integer | 学生ID (FK) |
| class_id | Integer | 班级ID (FK) |
| academic_year | String(20) | 学年 |
| join_date | Date | 加入班级日期 |
| leave_date | Date | 离开班级日期 |
| is_current | Boolean | 是否为当前班级 |

**作用**: 实现学生与班级的多对多关系，支持学生跨学年班级变更追踪

### 4.3 体测数据模型

#### PhysicalTest (体测数据)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| student_id | Integer | 学生ID (FK) |
| class_id | Integer | 班级ID (FK) |
| test_date | Date | 测试日期 |
| test_type | String(50) | 测试类型(期中/期末/日常) |
| height | Float | 身高(cm) |
| weight | Float | 体重(kg) |
| vital_capacity | Integer | 肺活量(ml) |
| run_50m | Float | 50米跑(秒) |
| run_800m | Integer | 800米跑(秒) |
| run_1000m | Integer | 1000米跑(秒) |
| sit_and_reach | Float | 坐位体前屈(cm) |
| standing_long_jump | Integer | 立定跳远(cm) |
| pull_up | Integer | 引体向上(个) |
| skip_rope | Integer | 跳绳(个/分钟) |
| total_score | Float | 总分 |
| grade | String(10) | 等级(A/B/C/D) |

**关联关系**:
- `N:1` → Student (学生)
- `N:1` → Class (班级)

### 4.4 运动会模型

#### SportsMeet (运动会)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| name | String(100) | 运动会名称 |
| start_date | Date | 开始日期 |
| end_date | Date | 结束日期 |
| location | String(200) | 举办地点 |
| status | Enum | 状态(planning/registration/scheduled/ongoing/completed/canceled) |
| organizer_id | Integer | 组织者ID (FK) |
| school_id | Integer | 所属学校ID (FK) |
| school_year_id | Integer | 所属学年ID (FK) |
| total_events | Integer | 总项目数 |
| total_athletes | Integer | 总运动员数 |

**关联关系**:
- `N:1` → School (学校)
- `N:1` → SchoolYear (学年)
- `1:N` → Event (项目)
- `1:N` → Registration (报名)
- `1:N` → Schedule (赛程)

#### Event (项目)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| sports_meet_id | Integer | 所属运动会ID (FK) |
| name | String(100) | 项目名称 |
| event_type | Enum | 项目类型(track/field/relay/team) |
| gender | Enum | 性别限制 |
| min_grade | Integer | 最低年级 |
| max_grade | Integer | 最高年级 |
| venue_id | Integer | 场馆ID (FK) |
| referee_id | Integer | 裁判ID (FK) |

**关联关系**:
- `N:1` → SportsMeet (运动会)
- `N:1` → Venue (场馆)
- `1:N` → Registration (报名)
- `1:N` → Schedule (赛程)
- `1:N` → EventResult (成绩)

#### Registration (报名)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | Integer | 主键 |
| sports_meet_id | Integer | 所属运动会ID (FK) |
| event_id | Integer | 所属项目ID (FK) |
| student_id | Integer | 学生ID (FK) |
| status | Enum | 报名状态(pending/approved/rejected/withdrawn/completed) |
| assigned_number | String(20) | 分配编号 |
| final_result | String(20) | 最终成绩 |
| rank | Integer | 排名 |

**关联关系**:
- `N:1` → SportsMeet (运动会)
- `N:1` → Event (项目)
- `N:1` → Student (学生)

---

## 五、API接口清单

### 5.1 认证接口 `/api/v1/auth`
| 方法 | 路径 | 功能 |
|------|------|------|
| POST | /login | 用户登录 |
| POST | /register | 用户注册 |
| POST | /logout | 用户登出 |
| POST | /refresh | 刷新Token |

### 5.2 学生管理接口 `/api/v1/students`
| 方法 | 路径 | 功能 |
|------|------|------|
| GET | / | 获取学生列表（分页、搜索、过滤） |
| GET | /{student_id} | 获取学生详情 |
| POST | / | 创建新学生 |
| PUT | /{student_id} | 更新学生信息 |
| DELETE | /{student_id} | 删除学生 |
| GET | /{student_id}/classes | 获取学生班级历史 |
| POST | /{student_id}/classes | 分配学生到班级 |

### 5.3 班级管理接口 `/api/v1/classes`
| 方法 | 路径 | 功能 |
|------|------|------|
| GET | / | 获取班级列表 |
| GET | /{class_id} | 获取班级详情 |
| POST | / | 创建班级 |
| PUT | /{class_id} | 更新班级信息 |
| DELETE | /{class_id} | 删除班级 |
| GET | /{class_id}/students | 获取班级学生列表 |

### 5.4 体测数据接口 `/api/v1/physical-tests`
| 方法 | 路径 | 功能 |
|------|------|------|
| GET | / | 获取体测记录列表 |
| GET | /{test_id} | 获取体测详情 |
| POST | / | 创建体测记录 |
| PUT | /{test_id} | 更新体测记录 |
| DELETE | /{test_id} | 删除体测记录 |
| GET | /statistics | 获取体测统计数据 |
| GET | /history | 获取体测历史 |
| GET | /score-distribution | 获取总分分布 |
| GET | /grade-distribution | 获取等级分布 |
| GET | /grade-comparison | 获取年级成绩对比 |
| GET | /gender-comparison | 获取性别成绩对比 |
| GET | /item-analysis | 获取单项成绩分析 |

### 5.5 运动会接口 `/api/v1/sports-meets`
| 方法 | 路径 | 功能 |
|------|------|------|
| GET | / | 获取运动会列表 |
| GET | /{id} | 获取运动会详情 |
| POST | / | 创建运动会 |
| PUT | /{id} | 更新运动会 |
| DELETE | /{id} | 删除运动会 |
| GET | /dashboard | 获取仪表盘数据 |
| GET | /events | 获取项目列表 |
| GET | /venues | 获取场馆列表 |
| GET | /schedules | 获取赛程列表 |
| GET | /referees | 获取裁判列表 |

### 5.6 学年管理接口 `/api/v1/school-years`
| 方法 | 路径 | 功能 |
|------|------|------|
| GET | / | 获取学年列表 |
| GET | /active | 获取当前活跃学年 |
| POST | / | 创建学年 |
| PUT | /{id} | 更新学年 |
| DELETE | /{id} | 删除学年 |
| POST | /{id}/activate | 设置活跃学年 |

---

## 六、前端页面结构

### 6.1 公共页面
- `/login` - 登录页
- `/register` - 注册页

### 6.2 主控台
- `/` - 仪表盘 (Dashboard)
- `/school-info` - 学校信息
- `/school-year` - 学年管理

### 6.3 人员管理
- `/classes` - 班级管理
- `/students` - 学生管理
- `/users` - 用户管理
- `/student-history` - 学生历史记录

### 6.4 体测系统
- `/physical-test` - 体测仪表盘
- `/physical-test/test-items` - 测试项目
- `/physical-test/score-management` - 成绩管理
- `/physical-test/statistics` - 统计分析
- `/physical-test/score-standards` - 评分标准

### 6.5 运动会系统
- `/sports-meet` - 运动会仪表盘
- `/sports-meet/management` - 运动会管理
- `/sports-meet/events` - 项目管理
- `/sports-meet/registration` - 报名管理
- `/sports-meet/audit` - 报名审核
- `/sports-meet/statistics` - 统计分析
- `/sports-meet/scheduling` - 赛程编排
- `/sports-meet/results` - 成绩记录
- `/sports-meet/reports` - 报告生成
- `/sports-meet/referees` - 裁判管理
- `/sports-meet/venues` - 场馆管理

---

## 七、权限控制

### 7.1 用户角色
| 角色 | 说明 |
|------|------|
| admin | 管理员 - 拥有所有权限 |
| teacher | 教师 - 学生管理、班级管理、体测数据管理 |
| student | 学生 - 查看个人信息、体测数据 |
| parent | 家长 - 查看学生信息 |

### 7.2 权限类型
- `student_manage` - 学生管理
- `class_manage` - 班级管理
- `physical_test_manage` - 体测管理
- `sports_meet_manage` - 运动会管理

---

## 八、数据关联逻辑总结

### 8.1 学校-学年-班级层级关系
```
学校 (School)
└── 学年 (SchoolYear) [每学年独立]
    └── 班级 (Class) [绑定学年]
        └── 学生 (Student) [通过StudentClassRelation关联]
```

### 8.2 学生跨学年流转
- 学生通过 `StudentClassRelation` 表关联到班级
- `is_current` 字段标识当前所属班级
- `join_date` / `leave_date` 记录时间节点
- 支持查询学生的完整班级变更历史

### 8.3 体测数据归档
- 体测数据直接关联 `student_id` 和 `class_id`
- 支持按学年、班级、学生维度查询
- 统计分析支持：成绩分布、等级分布、年级对比、性别对比

### 8.4 运动会报名流程
```
运动会 (SportsMeet)
├── 项目 (Event) [定义比赛项目]
│   └── 报名 (Registration) [学生报名]
│       └── 成绩 (EventResult) [比赛成绩]
└── 赛程 (Schedule) [时间安排]
    └── 场馆 (Venue) [比赛地点]
```

---

## 九、国家学生体质健康标准数据

系统内置了完整的《国家学生体质健康标准》评分表数据，包括：

### 评分表
- BMI (男/女)
- 肺活量 (男/女)
- 50米跑 (男/女)
- 坐位体前屈 (男/女)
- 跳绳 (男/女)
- 立定跳远 (男/女)
- 仰卧起坐/引体向上 (男/女)
- 耐力跑 (男/女)

### 加分表
- 跳绳加分 (男/女)
- 引体向上加分 (男)
- 仰卧起坐加分 (女)
- 1000米跑加分 (男)
- 800米跑加分 (女)

---

## 十、系统运行说明

### 后端启动
```bash
cd sport-api
python main.py
# 默认运行在 http://127.0.0.1:8002
```

### 前端启动
```bash
cd sport-web
npm install --legacy-peer-deps
npm run dev
# 默认运行在 http://localhost:5173
```

### 健康检查
- API状态: `GET /health`
- 数据库连接状态
- Redis连接状态（如配置）

---

**报告完毕**
